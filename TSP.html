<!doctype html>
<html lang="en">
<head>
  <link rel="stylesheet" href="assets/ol3/css/ol.css" type="text/css">
  <link rel="stylesheet" href="assets/css/styles.css" type="text/css">
  <script src='https://rawgit.com/Turfjs/turf/v2.0.2/turf.min.js'></script>
  <script src="assets/ol3/js/ol.js"></script>
  <script src="assets/js/es6-promise.min.js"></script>
  <script src="assets/js/fetch.js"></script>
  <script src="assets/js/helpers.js"></script>
  <script src="assets/js/jquery-1.12.0.min.js"></script>
  <script src="assets/js/tspant.js"></script>
  <!-- <script src="http://openlayers.org/en/v3.16.0/build/ol.js"></script> -->
  <!-- 右下角工具 -->
<link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

<link rel='stylesheet prefetch' href='css/animate.min.css'>
<link rel="stylesheet" type="text/css" href="css/spindefault.css">
<link rel="stylesheet" type="text/css" href="css/stylespage1.css">


<!-- 主界面css -->
<link rel="stylesheet" type="text/css" href="font/titillium/stylesheet.css">
<link rel="stylesheet" type="text/css" href="font/exo-demibold/stylesheet.css">
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/resetpage1.css">
<link rel="stylesheet" type="text/css" href="css/animation.css">
<link rel="stylesheet" type="text/css" href="css/blue/responsive.css">
<link rel="stylesheet" type="text/css" href="css/blue/color.css">

<link rel="stylesheet" type="text/css" href="css/live-preview.css">
<link rel="stylesheet" type="text/css" href="live-font/stylesheet.css">

<script type="text/javascript" src="js/modernizr.custom.29473.js"></script>
<script type="text/javascript" src="js/dropdown.js"></script>
 <!-- 打印地图 -->
  <script type="text/javascript" src="js/FileSaver.js"></script>
  <script type="text/javascript" src="js/canvas-toBlob.js"></script>
  <title>路径规划</title>
  <style type="text/css">
    #outText
    {
      position:fixed;
      right:200px; 
      bottom:20px; 

      width: 450px;
    height: 240px;
    margin: 50px;
    background-color: #f0f3f9;
    /*position:relative;*/
    z-index: 999;
    /*设置边框蓝光*/
    -moz-box-shadow:0 0 25px #697cf5;
    -webkit-box-shadow:0 0 25px #697cf5;
    box-shadow:0 0 25px #8cb9f5;
    /*绿光*/
   /* -moz-box-shadow:0 0 25px #2aaa8a;
    -webkit-box-shadow:0 0 25px #2aaa8a;
    box-shadow:0 0 25px #2aaa8a;*/

    /*设置圆角*/
    -moz-border-radius: 15px;      /* Gecko browsers */
    -webkit-border-radius: 15px;   /* Webkit browsers */
    border-radius:15px;            /* W3C syntax */
    }
  </style>
</head>
<body>
<ul class="nav" style="position:fixed;">
  
  <!-- Start Home -->
  <li id="first">
    <div id="cover1"><a href="3d/buildingsdemo.html">三维校园<i class="icon-chevron-down"></i></a></div>
    <div id="icon"><i class="icon-home" ></i></div>
     <ul class="one" id="home">
      <li>
          <h3><i class="icon-user"></i>Welcome</h3>
            <p id="p-first">中国地质大学（武汉）位于武汉东湖国家自主创新示范区腹地。学校拥有国家4A级旅游景区——逸夫博物馆，是全国文明单位、湖北省最佳文明单位。校园环境优美，教育、科研、学术氛围浓厚，拥有现代化的教学楼群、图书馆、学生公寓和近万台随时上网的计算机等相关配套设施，为莘莘学子提供了良好的学习、生活和成长的环境。</p>
            <!-- <img src="img/didalogo.png"> -->
            <a href="http://www.cug.edu.cn/new/">中国地质大学</a>
        </li>
     </ul>
  </li>
  
  <!-- Start Portfolio -->
  <li>
    <div id="cover1"><a href="clustertest.html">报修管理<i class="icon-chevron-down"></i></a></div>
    <div id="icon"><i class="icon-briefcase" ></i></div>
  </li>
  
  <!-- Start Services -->
  <li>
    <div id="cover1"><a href="TSP.html">路径导航<i class="icon-chevron-down"></i></a></div>
    <div id="icon"><i class="icon-truck" ></i></div>
   <!--  <ul class="one" id="menu">
      <li><a href="#" id="addpoint" data-toggle="false" onclick="addtsppoint()">添加点</a></li>
      <li><a href="#">文字添加</a></li>
      <li><a href="#"  onclick="shortestpath()">路径规划</a></li>
    </ul> -->
  </li>
 
  <li>
    <div id="cover1"><a href="heatmap.html">垃圾箱管理<i class="icon-chevron-down"></i></a></div>
    <div id="icon"><i class="icon-book" ></i></div>
    <ul class="one" id="about">
      <li><img src="img/thumb1.png" alt="image">
        <h3><i class="icon-user"></i>模型简介及参数说明</h3>
        <p>
        道路理论垃圾桶数量 =<br>（人均垃圾量*一天总的道路人流量）/（容量*清理次数）<br><br>
若理论数量>实际数量,增加垃圾桶数量或增加清理次数<br>若理论数量>实际数量,减少垃圾桶数量或保持现状<br><br>
您可以通过重新设定清理次数或垃圾桶个数来计算上述比值得出优化配置结果（增加几个，在哪个位置合适，垃圾桶数量过多会影响美观性,这时您可以考虑增加清理次数来代替增加数量）
        </p>
        <h6><i class="icon-quote-left"></i>垃圾也有用，请别乱扔它。<i class="icon-quote-right"></i></h6>
      </li>
    </ul>
  </li>
  
  <!-- Start Contact -->
  <li>
    <div id="cover1"><a href="joins-inside.html">失物招领<i class="icon-chevron-down"></i></a></div>
    <div id="icon"><i class="icon-envelope" ></i></div>
    <ul class="one" id="contact">
      <li id="part-right">
        <p>地点<em>*</em></p>
        <input name="name" type="text" id="name">
        <p>联系方式<em>*</em></p>
        <input name="email" type="text" id="email">
        <p>描述<em>*</em></p>
        <textarea name="comment" cols="" rows="" id="comment"></textarea>
        <p>请在地图上添加物品丢失的位置<em>*</em></p>
      </li>
    </ul>
  </li>
  
  <!-- Start Search -->
  <li id="search">
    <input name="search" type="text" placeholder="Search" id="txt_search2">
    <a href="#"><i class="icon-search"></i></a> 
  </li>
  
</ul>
  <div id="map" class="map"  style="width:100%;height:100%"></div>
  <div id="outText" style="display:none">
      <a href="#" style="right:10px;top:10px;">×</a>
  </div>


    <!-- 右下角工具栏 -->
<div class="htmleaf-container">
  <div id='ss_menu'>
    <div>

    <i class="fa fa-pencil"  id="drawtoggle" data-toggle="false"><a id="export-png" class="btn btn-default" download="map.png"></a></i>
    </div>
    <div>
    <i class="fa fa-flash" id="resultbastpath" onclick="resultbastpathfun()" data-toggle="false"></i>
    </div>
    <div>
    <i class="fa fa-trash-o" id="clearpath" onclick="clearpathfun()" data-toggle="false"></i>
    </div>
    <div>
    <i class="fa fa-print" id="printpathmap" onclick="printpathmapfun()"></i>
    </div>
    <div class='menu'>
    <div class='share ' id='ss_toggle' data-rot='180'>
      <div class='circle'></div>
      <div class='bar'></div>
    </div>
    </div>
  </div>
</div>
<script>
//右下角旋转菜单
$(document).ready(function (ev) {
  var toggle = $('#ss_toggle');
  var menu = $('#ss_menu');
  var rot;
  $('#ss_toggle').on('click', function (ev) {
    rot = parseInt($(this).data('rot')) - 180;
    menu.css('transform', 'rotate(' + rot + 'deg)');
    menu.css('webkitTransform', 'rotate(' + rot + 'deg)');
    if (rot / 180 % 2 == 0) {
      toggle.parent().addClass('ss_active');
      toggle.addClass('close');
    } else {
      toggle.parent().removeClass('ss_active');
      toggle.removeClass('close');
    }
    $(this).data('rot', rot);
  });
  menu.on('transitionend webkitTransitionEnd oTransitionEnd', function () {
    if (rot / 180 % 2 == 0) {
      $('#ss_menu div i').addClass('ss_animate');
    } else {
      $('#ss_menu div i').removeClass('ss_animate');
    }
  });
});
</script>
  <script type="text/javascript">

      // Style
      var defaultStyle = [
        new ol.style.Style({
          image: new ol.style.Circle({
            stroke: new ol.style.Stroke({
              color: 'white'
            }),
            fill: new ol.style.Fill({
              color: '#1f6b75'
            }),
            radius: 4
          })
        })
      ];

//设置点的图标

var iconStyle = new ol.style.Style({
  image: new ol.style.Icon(({
    src: 'data/icon/point.png'
    // src: 'data/icon/marker2.png'
  }))
});


console.log(iconStyle);
      // 申明一个用来存放点的资源
      var vectorSourcePoints = new ol.source.GeoJSON();
      var vectorLayerPoints = new ol.layer.Vector({
        source: vectorSourcePoints,
        style: iconStyle
      });

      // Declare a source for drawing
      var vectorSourceDrawing = new ol.source.GeoJSON();
      var vectorLayerDrawing = new ol.layer.Vector({
        source: vectorSourceDrawing
      });


      var openStreetMapLayer = new ol.layer.Tile({
        source:new ol.source.OSM()
    });
      // Instanciate a map and add layers
      var map = new ol.Map({
        target: 'map',
        layers: [
          openStreetMapLayer,
          vectorLayerPoints,
          vectorLayerDrawing
        ],

        view: new ol.View({
          center: ol.proj.transform(
            // [-1.5603, 47.2383],
             [114.3983815703, 30.5256872217],
            'EPSG:4326',
            'EPSG:3857'
          ),
          zoom: 15
        })
      });

      var featureOverlay = new ol.FeatureOverlay({
        map: map,
        style: [
          new ol.style.Style({
            image: new ol.style.Circle({
              stroke: new ol.style.Stroke({
                color: 'white'
              }),
              fill: new ol.style.Fill({
                color: 'black'
              }),
              radius: 5
            })
          })
        ]
      });

      // We will share the geojson content to be able to use Turf
      var myPoints;

      // fetchJSON('assets/data/key_shop_with_name_nantes_area.geojson')
      // fetchJSON('data/json/losteventgeojson.geojson')
      fetchJSON('assets/data/pointtest2.geojson')

        .then(function(points_fc) {
        myPoints = points_fc;
        vectorSourcePoints.addFeatures(geojsonToFeatures(points_fc, {
          featureProjection: 'EPSG:3857'
        }));
      });

      // Create a button and bind a click function
      var button1 = document.getElementById('drawtoggle');
      var draw;
      button1.onclick = function(e) {
        var toggleState = this.getAttribute('data-toggle');
        // Some issues due to type. Can't use !toggleState to go back and forth
        // between true and false (type is not boolean but a string)
        // Remove drawing interaction because
        if (toggleState === 'true') {
          this.setAttribute('data-toggle', 'false');
          map.removeInteraction(draw);
        } else {
          this.setAttribute('data-toggle', 'true');
          // Assign draw interaction (variable created before for scope reason)
          draw = new ol.interaction.Draw({
            source: vectorSourceDrawing,
            type: 'Point'
          });

          // Bind event on the draw component
          draw.on('drawend', function(e) {
            // Remove immediately other features for demo purpose
            
            vectorSourceDrawing.clear();
            var formatDraw = new ol.format.GeoJSON();
            featureDraw = formatDraw.writeFeature(e.feature.clone(), {
              dataProjection: 'EPSG:4326',
              featureProjection: 'EPSG:3857'
            });
            vectorSourceDrawing.addFeature(e.feature);
            console.log(featureDraw);

            //将绘制的点加入mypoint以便于后面做TSP
            vectorSourcePoints.addFeature(e.feature);

            myPoints.features.push(featureDraw);
            console.log(myPoints);
          });
          // Add the interaction to the map
          map.addInteraction(draw);
        }
      };
function printpathmapfun()
{
   console.log("保存地图");
    canvas = document.getElementsByTagName('canvas')[0];
    canvas.toBlob(function (blob) {
      saveAs(blob, 'map.png');
    })
}
function clearpathfun()
{
      clear();
}
function resultbastpathfun()
{
  initAllMats();
  ACA_TSP();
}
    </script>
</body>
</html>