<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width">
    <title>垃圾箱管理</title>
    <!-- <link rel="stylesheet" href="http://openlayers.org/en/v3.16.0/css/ol.css" type="text/css">
  -->
    <script type="text/javascript" src="js/echarts.js"></script>
    <script src="http://openlayers.org/en/v3.16.0/build/ol.js"></script>
    <link rel="stylesheet" type="text/css" href="font/titillium/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="font/exo-demibold/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/resetpage1.css">
    <link rel="stylesheet" type="text/css" href="css/animation.css">
    <link rel="stylesheet" type="text/css" href="css/blue/responsive.css">
    <link rel="stylesheet" type="text/css" href="css/blue/color.css">
    <link rel="stylesheet" type="text/css" href="css/live-preview.css">
    <link rel="stylesheet" type="text/css" href="live-font/stylesheet.css">
    <script type="text/javascript" src="js/modernizr.custom.29473.js"></script>
    <script type="text/javascript" src="js/jquery-1.12.0.min.js"></script>
    <script type="text/javascript" src="js/dropdown.js"></script>
    <link rel="stylesheet" href="assets/ol3/css/ol.css" type="text/css">
    <!-- <link rel="stylesheet" href="assets/css/styles.css" type="text/css"> -->
    <script src='https://rawgit.com/Turfjs/turf/v2.0.2/turf.min.js'></script>
<script type="text/javascript" src="js/style-table.js"></script>
<link rel="stylesheet" type="text/css" media="screen" href="css/css-table.css" />
    <!-- <script stc="assets/js/olnew.js"></script>
-->
    <!-- <script src="assets/ol3/js/ol-debug.js"></script>
-->
    <script src="assets/js/es6-promise.min.js"></script>
    <script src="assets/js/fetch.js"></script>
    <script src="assets/js/helpers.js"></script>


  <!-- 右下角工具 -->
<link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel='stylesheet prefetch' href='css/animate.min.css'>
<link rel="stylesheet" type="text/css" href="css/spindefault.css">
<link rel="stylesheet" type="text/css" href="css/stylespage1.css">
 <!-- 打印地图 -->
  <script type="text/javascript" src="js/FileSaver.js"></script>
  <script type="text/javascript" src="js/canvas-toBlob.js"></script>

    <style type="text/css">
      html,body{
        background-color: white;
      }
    </style>
      <style type="text/css">
    #popdivright
    {
      position:fixed;
      right:106px; 
      bottom:220px; 

      width: 950px;
    height: 640px;
    margin: 50px;
    background-color: #f0f3f9;
    /*position:relative;*/
    z-index: 999;
    /*设置边框蓝光*/
    -moz-box-shadow:0 0 25px #697cf5;
    -webkit-box-shadow:0 0 25px #697cf5;
    box-shadow:0 0 25px #8cb9f5;

    /*设置圆角*/
    -moz-border-radius: 15px;      /* Gecko browsers */
    -webkit-border-radius: 15px;   /* Webkit browsers */
    border-radius:15px;            /* W3C syntax */
    }
  </style>
</head>

<body>
    <ul class="nav" style="position:fixed;">
        <!-- Start Home -->
        <li id="first">
            <div id="cover1"><a href="3d/buildingsdemo.html">三维校园<i class="icon-chevron-down"></i></a></div>
            <div id="icon"><i class="icon-home"></i></div>
            <ul class="one" id="home">
                <li>
                    <h3><i class="icon-user"></i>Welcome</h3>
                    <p id="p-first">中国地质大学（武汉）位于武汉东湖国家自主创新示范区腹地。学校拥有国家4A级旅游景区——逸夫博物馆，是全国文明单位、湖北省最佳文明单位。校园环境优美，教育、科研、学术氛围浓厚，拥有现代化的教学楼群、图书馆、学生公寓和近万台随时上网的计算机等相关配套设施，为莘莘学子提供了良好的学习、生活和成长的环境。</p>
                    <!-- <img src="img/didalogo.png"> -->
                    <a href="http://www.cug.edu.cn/new/">中国地质大学</a>
                </li>
            </ul>
        </li>
        <!-- Start Portfolio -->
        <li>
            <div id="cover1"><a href="clustertest.html">报修管理<i class="icon-chevron-down"></i></a></div>
            <div id="icon"><i class="icon-briefcase"></i></div>
        </li>
        <!-- Start Services -->
        <li>
            <div id="cover1"><a href="TSP.html">路径导航<i class="icon-chevron-down"></i></a></div>
            <div id="icon"><i class="icon-truck"></i></div>
        </li>
        <li>
            <div id="cover1"><a href="heatmap.html">垃圾箱管理<i class="icon-chevron-down"></i></a></div>
            <div id="icon"><i class="icon-book"></i></div>
            <ul class="one" id="about">
                <li><img src="img/thumb1.png" alt="image">
                    <h3><i class="icon-user"></i>模型简介及参数说明</h3>
                    <p>
                        道路理论垃圾桶数量 =
                        <br>（人均垃圾量*一天总的道路人流量）/（容量*清理次数）
                        <br>
                        <br> 若理论数量>实际数量,增加垃圾桶数量或增加清理次数
                        <br>若理论数量>实际数量,减少垃圾桶数量或保持现状
                        <br>
                        <br> 您可以通过重新设定清理次数或垃圾桶个数来计算上述比值得出优化配置结果（增加几个，在哪个位置合适，垃圾桶数量过多会影响美观性,这时您可以考虑增加清理次数来代替增加数量）
                    </p>
                    <h6><i class="icon-quote-left"></i>垃圾也有用，请别乱扔它。<i class="icon-quote-right"></i></h6>
                </li>
            </ul>
        </li>
        <!-- Start Contact -->
        <li>
            <div id="cover1"><a href="joins-inside.html">失物招领<i class="icon-chevron-down"></i></a></div>
            <div id="icon"><i class="icon-envelope"></i></div>
            <ul class="one" id="contact">
                <li id="part-right">
                    <p>地点<em>*</em></p>
                    <input name="name" type="text" id="name">
                    <p>联系方式<em>*</em></p>
                    <input name="email" type="text" id="email">
                    <p>描述<em>*</em></p>
                    <textarea name="comment" cols="" rows="" id="comment"></textarea>
                    <p>请在地图上添加物品丢失的位置<em>*</em></p>
                </li>
            </ul>
        </li>
        <!-- Start Search -->
        <li id="search">
            <input name="search" type="text" placeholder="Search" id="txt_search2">
            <a href="#"><i class="icon-search"></i></a>
        </li>
    </ul>
    <div id="totalmap" style="width:100%;height:60%">
        <div id="map" class="map" style="float:left;width:50%;height:100%"></div>
        <div id="map1" class="map1" style="float:left; width:50%;height:100%"></div>
    </div>

    <div id="popdiv" style="display:block;height:40%;width:70%;margin-left:10px;"></div>
    <div id="popdivright" style="display:none;height:40%;width:80%;margin-left:50px;margin-top:50px;">
        <table id="travel">
    <thead>    
        <tr>
            <th scope="col" rowspan="2">道路垃圾桶分布合理性</th>
            <th scope="col" colspan="6">道路参数</th>
            <th scope="col" colspan="1"><a id="closepopdiv" href="#" onclick=closepopdiv() style="color:red">×</a></th>
        </tr>
        
        <tr>
            <th scope="col">日均人流量(百人)</th>
            <th scope="col">功能区</th>
            <th scope="col">人均垃圾量(cm3)</th>
            <th scope="col">垃圾箱容量(升)</th>
            <th scope="col">日清理次数</th>
            <th scope="col">理论个数</th>
            <th scope="col">实际个数</th>
        </tr>        
    </thead>
    <tbody>
        <tr>
        <th scope="row">荟萃路北段</th>
            <td name="renliuliang">20</td>
            <td>餐饮区</td>
            <td name="rubbish">15</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>0</td>
        </tr>
        
        <tr>
            <th scope="row">网球场北路</th>
            <td name="renliuliang">18</td>
            <td>餐饮区</td>
            <td name="rubbish">15</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>3</td>
        </tr>
        
        <tr>
            <th scope="row">求实路(体育馆)</th>
            <td name="renliuliang">48</td>
            <td>道路,教学区</td>
            <td name="rubbish">11</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>3</td>
        </tr>
        
        <tr>
            <th scope="row">求实路(教三南)</th>
           <td name="renliuliang">28</td>
            <td>教学区,道路</td>
            <td name="rubbish">11</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>5</td>
        </tr>
        
        <tr>
            <th scope="row">弘毅路</th>
            <td name="renliuliang">40</td>
            <td>住宿区,餐饮区</td>
            <td name="rubbish">16</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>4</td>
        </tr>
        
        <tr>
            <th scope="row">西一路</th>
            <td name="renliuliang">24</td>
            <td>道路</td>
            <td name="rubbish">7</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>1</td>
        </tr>
        
        <tr>
            <th scope="row">教三南一路</th>
            <td name="renliuliang">18</td>
            <td>教学区</td>
            <td name="rubbish">12</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>3</td>
        </tr>
        <tr>
            <th scope="row">西二路西</th>
            <td name="renliuliang">10</td>
            <td>教学区</td>
            <td name="rubbish">8</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>3</td>
        </tr>
        <tr>
            <th scope="row">西二路东</th>
            <td name="renliuliang">15</td>
            <td>休闲区</td>
            <td name="rubbish">10</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>6</td>
        </tr>
        <tr>
            <th scope="row">天桥</th>
           <td name="renliuliang">20</td>
            <td>道路</td>
            <td name="rubbish">8</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>2</td>
        </tr>
        <tr>
            <th scope="row">桃李路</th>
            <td name="renliuliang">13</td>
            <td>休闲区</td>
            <td name="rubbish">10</td>
            <td>8</td>
            <td><input  size="3" name="cishu" type="number" value="1" min="1" max="23" oninput="keydown()"></td>
            <td><input size="3" type="Text" name="lnum" value="2" readonly="readonly"></td>
            <td>3</td>
        </tr>
    </tbody>
</table>
    </div>
<script>
keydown();
function keydown(){
    var renliuliang=document.getElementsByName("renliuliang");  //道路人流量
    var rubbish=document.getElementsByName("rubbish");          //道路人均垃圾量
    var cishu=document.getElementsByName("cishu");                //日清理次数
    var lnum=document.getElementsByName("lnum");                  //理论垃圾桶数量
    console.log(renliuliang);
    console.log(rubbish);
    console.log(cishu);
    for (var i = document.getElementsByName("lnum").length - 1; i >= 0; i--) {
        lnum[i].value=(renliuliang[i].innerText)*100*(rubbish[i].innerText)/(cishu[i].value*8000);
    }
}
function closepopdiv(){
    document.getElementById("popdivright").style.display='none';
}
</script>
        <!-- 右下角工具栏 -->
<div class="htmleaf-container">
  <div id='ss_menu'>
    <div>
    <i class="fa fa-print" id="printmap" onclick="printmapfun()"><a id="export-png" class="btn btn-default" download="map.png"></a></i>
    </div>
    <div>
    <i class="fa fa-bar-chart" id="measurelength" onclick="showpopdiv()" data-toggle="false"></i>
    </div>
    <div>
    <i class="fa fa-calculator" id="measurearea" onclick="showpopright()" data-toggle="false"></i>
    </div>
    <div>
    <i class="fa fa-globe" id="globemap" onclick="globemapfun()"></i>
    </div>
    <div class='menu'>
    <div class='share ' id='ss_toggle' data-rot='180'>
      <div class='circle'></div>
      <div class='bar'></div>
    </div>
    </div>
  </div>
</div>
<script>
//右下角旋转菜单
$(document).ready(function (ev) {
  var toggle = $('#ss_toggle');
  var menu = $('#ss_menu');
  var rot;
  $('#ss_toggle').on('click', function (ev) {
    rot = parseInt($(this).data('rot')) - 180;
    menu.css('transform', 'rotate(' + rot + 'deg)');
    menu.css('webkitTransform', 'rotate(' + rot + 'deg)');
    if (rot / 180 % 2 == 0) {
      toggle.parent().addClass('ss_active');
      toggle.addClass('close');
    } else {
      toggle.parent().removeClass('ss_active');
      toggle.removeClass('close');
    }
    $(this).data('rot', rot);
  });
  menu.on('transitionend webkitTransitionEnd oTransitionEnd', function () {
    if (rot / 180 % 2 == 0) {
      $('#ss_menu div i').addClass('ss_animate');
    } else {
      $('#ss_menu div i').removeClass('ss_animate');
    }
  });
});
</script>
    <script>
    var vector = new ol.layer.Heatmap({
        source: new ol.source.Vector({
            url: 'data/kml/midu.kml',
            // url: 'assets/data/pointclusterkml.kml',
            format: new ol.format.KML({
                extractStyles: false
            })
        })
    });
    console.log(vector);
    vector.getSource().on('addfeature', function(event) {
        var name = event.feature.get('name');
        var magnitude = parseFloat(name.substr(2));
        event.feature.set('weight', magnitude - 5);
    });
    var openStreetMapLayer = new ol.layer.Tile({
        source:new ol.source.OSM()
    });
    var mapcenter=[114.3945500000, 30.5247090000];
    var mapCenter=ol.proj.fromLonLat([114.3945500000, 30.5247090000]);

    var view1 = new ol.View({
        // the view's initial state
        center:ol.proj.transform(mapcenter, 'EPSG:4326', 'EPSG:3857'),
        zoom: 16
      });
    var map = new ol.Map({
        layers: [openStreetMapLayer, vector],
        target: 'map',
        view: view1
    });
    //缓冲区分析部分
    var geojsonObject = {
        "type": "FeatureCollection",
        "features": [{
            "type": "Feature",
            "properties": {},
            "geometry": {
                "type": "Point",
                "coordinates": [114.39778640000009, 30.522237200000063]
            }
        }]
    };
    var vectorSourcePolygons = new ol.source.Vector({
        features: (new ol.format.GeoJSON()).readFeatures(geojsonObject)
    });

    var pointsStyle = [new ol.style.Style({
        image: new ol.style.Circle({
            fill: new ol.style.Fill({
                color: 'black'
            }),
            radius: 3
        })
    })];

    var vectorLayerPolygons = new ol.layer.Vector({
        source: vectorSourcePolygons
    });

    // Instanciate a map and add layers
    var map1 = new ol.Map({

        target: 'map1',
        layers: [
            openStreetMapLayer,
            vectorLayerPolygons,
        ],
        view: map.getView()
    });

    fetchJSON('data/json/rubbishboxgeojson.geojson')
    // fetchJSON('assets/data/pointtest2.geojson')
        .then(function(polys_fc) {
            console.log(polys_fc);

            vectorSourcePolygons.addFeatures(geojsonToFeatures(polys_fc, {
                featureProjection: 'EPSG:3857'
            }));

            var buffer = turf.buffer(polys_fc, 0.03, 'kilometers');
            console.log(buffer);

            vectorSourcePolygons.addFeatures(geojsonToFeatures(buffer, {
                featureProjection: 'EPSG:3857'
            }));

        });

        showpopdiv();
        //人流量图表展示
        function showpopdiv(){
              var dom = document.getElementById("popdiv");
                var myChart = echarts.init(dom);
                // dom.style.display = 'block';
                var hours = ['12', '1', '2', '3', '4', '5', '6',
                        '7', '8', '9','10','11',
                        '12', '1', '2', '3', '4', '5',
                        '6', '7', '8', '9', '10', '11'];
                var days = ['周日', '周五', '周四',
                        '周三', '周二', '周一', '周六'];

                var data = [
                [0,0,0],[0,1,0],[0,2,0],[0,3,0],[0,4,0],[0,5,1],[0,6,1],[0,7,2],[0,8,6],[0,9,4],[0,10,4],[0,11,6],[0,12,5],[0,13,2],[0,14,3],[0,15,2],[0,16,3],[0,17,6],[0,18,7],[0,19,8],[0,20,4],[0,21,3],[0,22,2],[0,23,1],
                [1,0,0],[1,1,0],[1,2,0],[1,3,0],[1,4,0],[1,5,0],[1,6,1],[1,7,2],[1,8,7],[1,9,6],[1,10,6],[1,11,7],[1,12,5],[1,13,4],[1,14,2],[1,15,2],[1,16,3],[1,17,7],[1,18,8],[1,19,8],[1,20,5],[1,21,5],[1,22,4],[1,23,2],
                [2,0,0],[2,1,1],[2,2,0],[2,3,0],[2,4,0],[2,5,1],[2,6,3],[2,7,8],[2,8,15],[2,9,12],[2,10,9],[2,11,6],[2,12,8],[2,13,8],[2,14,14],[2,15,10],[2,16,8],[2,17,15],[2,18,15],[2,19,9],[2,20,5],[2,21,5],[2,22,5],[2,23,4],
                [3,0,0],[3,1,0],[3,2,0],[3,3,0],[3,4,0],[3,5,2],[3,6,3],[3,7,9],[3,8,10],[3,9,10],[3,10,12],[3,11,9],[3,12,10],[3,13,6],[3,14,9],[3,15,11],[3,16,9],[3,17,13],[3,18,15],[3,19,10],[3,20,6],[3,21,4],[3,22,2],[3,23,1],
                [4,0,0],[4,1,0],[4,2,0],[4,3,0],[4,4,0],[4,5,1],[4,6,6],[4,7,9],[4,8,12],[4,9,14],[4,10,8],[4,11,12],[4,12,12],[4,13,7],[4,14,4],[4,15,14],[4,16,5],[4,17,15],[4,18,14],[4,19,8],[4,20,7],[4,21,6],[4,22,2],[4,23,0],
                [5,0,0],[5,1,0],[5,2,0],[5,3,0],[5,4,0],[5,5,1],[5,6,1],[5,7,6],[5,8,13],[5,9,14],[5,10,7],[5,11,12],[5,12,12],[5,13,5],[5,14,15],[5,15,8],[5,16,10],[5,17,13],[5,18,14],[5,19,8],[5,20,5],[5,21,4],[5,22,2],[5,23,0],
                [6,0,0],[6,1,0],[6,2,0],[6,3,0],[6,4,0],[6,5,1],[6,6,1],[6,7,5],[6,8,14],[6,9,15],[6,10,7],[6,11,8],[6,12,15],[6,13,4],[6,14,13],[6,15,6],[6,16,10],[6,17,13],[6,18,15],[6,19,10],[6,20,8],[6,21,4],[6,22,2],[6,23,1]];
                data = data.map(function (item) {
                    return [item[1], item[0], item[2]];
                });

                option = {
                    title: {
                        text: '日人流量统计'
                    },
                    legend: {
                        data: ['Punch Card'],
                        left: 'right'
                    },
                    tooltip: {
                        position: 'top',
                        formatter: function (params) {
                            return params.value[2] + ' hundred people ' + 'of ' + days[params.value[1]];
                        }
                    },
                    grid: {
                        left: 2,
                        bottom: 10,
                        right: 10,
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: hours,
                        boundaryGap: false,
                        splitLine: {
                            show: true,
                            lineStyle: {
                                color: '#ddd',
                                type: 'dashed'
                            }
                        },
                        axisLine: {
                            show: false
                        }
                    },
                    yAxis: {
                        type: 'category',
                        data: days,
                        axisLine: {
                            show: false
                        }
                    },
                    series: [{
                        name: '人流量',
                        type: 'scatter',
                        symbolSize: function (val) {
                            return val[2] * 2;
                        },
                        data: data,
                        animationDelay: function (idx) {
                            return idx * 5;
                        }
                    }]
                };

                myChart.setOption(option, true);
        }
        function showpopright(){
                  document.getElementById('popdivright').style.display = 'block';
        }
        function globemapfun(e)   //回到初始位置
        {
          console.log("全图显示");
          var duration = 2000;
              var start = +new Date();
              var pan = ol.animation.pan({
                duration: duration,
                source: /** @type {ol.Coordinate} */ (view1.getCenter()),
                start: start
              });
              var bounce = ol.animation.bounce({
                duration: duration,
                resolution: 4 * view1.getResolution(),
                start: start
              });
              map.beforeRender(pan, bounce);
              map1.beforeRender(pan, bounce);
              view1.setCenter(mapCenter);
              view1.setZoom(16);
        }
        function printmapfun(e)   //下载地图
        {
            console.log("保存地图");
            canvas = document.getElementsByTagName('canvas')[0];
            canvas.toBlob(function (blob) {
              saveAs(blob, 'map.png');
            })
        }
        
    </script>
</body>

</html>
